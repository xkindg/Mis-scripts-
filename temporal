local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
   Name = "Jack's Dumper (Golden Edition)",
   LoadingTitle = "Loading...",
   LoadingSubtitle = "Anti-Freeze & Timeout Control",
   ConfigurationSaving = { Enabled = false },
   KeySystem = false,
})

local Stop = false
local CustomSaveInstance = nil

-- CONFIGURACIÃ“N (Restaurada)
local Config = {
    Decompile = true,       
    Timeout = 10,           -- Default solicitado: 10 segundos
    SavePlayers = false     
}

-- ================= TAB PRINCIPAL =================
local TabDump = Window:CreateTab("Dumper", 4483362458)
local StatusLabel = TabDump:CreateLabel("Status: Idle")

-- CARGAR MOTOR DEX (Esencial)
local function LoadDexSaveEngine()
    if CustomSaveInstance then return true end
    StatusLabel:Set("Status: Downloading Dex Engine...")
    local success, result = pcall(function()
        local repo = "https://raw.githubusercontent.com/luau/SynSaveInstance/main/"
        local loader = loadstring(game:HttpGet(repo .. "saveinstance.luau"), "saveinstance")
        local lib = loader() 
        return function(obj, filepath, options)
            options = options or {}
            options.Object = obj
            options.FilePath = filepath
            return lib(options)
        end
    end)
    if success then
        CustomSaveInstance = result
        return true
    else
        StatusLabel:Set("Error: " .. tostring(result))
        return false
    end
end

-- OPCIONES (Restauradas)
TabDump:CreateSection("Settings")

TabDump:CreateToggle({
   Name = "Decompile Scripts (Causes lag but saves code)",
   CurrentValue = true,
   Flag = "DecompileOn",
   Callback = function(Value)
       Config.Decompile = Value
   end,
})

TabDump:CreateSlider({
   Name = "Timeout per Object (Seconds)",
   Range = {5, 60},
   Increment = 1,
   Suffix = "s",
   CurrentValue = 10, -- 10 Segundos como pediste
   Callback = function(Value)
       Config.Timeout = Value
   end,
})

-- BOTÃ“N DE ACCIÃ“N
TabDump:CreateSection("Actions")

TabDump:CreateButton({
   Name = "ðŸ“‚ START FULL DUMP",
   Callback = function()
       Stop = false
       if not LoadDexSaveEngine() then return end
       
       -- Crear carpetas
       if makefolder then
           pcall(function() makefolder("Jack-Dump") end)
           pcall(function() makefolder("Jack-Dump/workspace") end)
       end
       
       local items = game.Workspace:GetChildren()
       local total = #items
       local current = 0
       
       Rayfield:Notify({Title = "Starting...", Content = "Exporting Workspace with Timeout: " .. Config.Timeout .. "s", Duration = 3})
       
       task.spawn(function()
           for _, item in ipairs(items) do
               if Stop then 
                   StatusLabel:Set("Status: STOPPED")
                   break 
               end
               
               -- Filtros bÃ¡sicos
               if not item:IsA("Terrain") and item ~= game.Workspace.CurrentCamera then
                   current = current + 1
                   
                   local cleanName = string.gsub(item.Name, "[^%w_-]", "")
                   if cleanName == "" then cleanName = "Item_" .. current end
                   local fileName = "Jack-Dump/workspace/" .. cleanName .. ".rbxmx"
                   
                   StatusLabel:Set("Saving: " .. item.Name)
                   
                   -- LÃ“GICA DE TIMEOUT (Anti-Freeze)
                   local finished = false
                   
                   task.spawn(function()
                       local dexOptions = {
                           Decompile = Config.Decompile,
                           RemovePlayerCharacters = false,
                           SavePlayers = Config.SavePlayers,
                           MaxThreads = 1 -- 1 hilo para mÃ¡xima estabilidad
                       }
                       
                       pcall(function()
                           CustomSaveInstance(item, fileName, dexOptions)
                       end)
                       finished = true
                   end)
                   
                   -- Bucle de espera (El reloj)
                   local waittime = 0
                   while not finished and waittime < Config.Timeout do
                       task.wait(0.5)
                       waittime = waittime + 0.5
                   end
                   
                   if not finished then
                       Rayfield:Notify({Title = "SKIPPED", Content = item.Name .. " took too long (> " .. Config.Timeout .. "s)", Duration = 2})
                       -- Seguimos al siguiente aunque este no haya terminado
                   end
                   
                   task.wait(0.1)
               end
           end
           
           if not Stop then
               StatusLabel:Set("Status: COMPLETED")
               -- MENSAJE EN INGLÃ‰S SOLICITADO
               Rayfield:Notify({
                   Title = "EXPORT COMPLETE",
                   Content = "Files saved in: Jack-Dump/workspace. Please check your executor files.",
                   Duration = 8,
                   Image = 4483362458
               })
           end
       end)
   end,
})

TabDump:CreateButton({
   Name = "â›” STOP EXPORT",
   Callback = function()
       Stop = true
       StatusLabel:Set("Status: Stopping...")
   end,
})

TabDump:CreateSection("Help Info")
-- MENSAJE EN INGLÃ‰S SOBRE LA RUTA
TabDump:CreateLabel("PATH INFO: Go to your Executor's folder.")
TabDump:CreateLabel("Look for: /Jack-Dump/workspace/")
TabDump:CreateLabel("Inside that folder are your .rbxmx files.")

-- ================= SECRET TAB =================
local TabSecret = Window:CreateTab("do not look", 4483362458)
TabSecret:CreateLabel("Jack is gay")
