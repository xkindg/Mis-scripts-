-- Script para Delta Executor: Men√∫ de emotes funcional
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")
local ContextActionService = game:GetService("ContextActionService")

-- Limpiar GUI previa
local GUI_NAME = "EmoteMenu_XSL"
if game:GetService("CoreGui"):FindFirstChild(GUI_NAME) then
    game:GetService("CoreGui")[GUI_NAME]:Destroy()
end
ContextActionService:UnbindCoreAction("Emote Menu Toggle")

-- Notificaci√≥n inicial
local function sendNotification(title, text, duration)
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = title,
            Text = text,
            Duration = duration
        })
    end)
end
sendNotification("Cargando...", "Iniciando Emote GUI...", 10)

-- Crear ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = GUI_NAME
screenGui.Parent = game:GetService("CoreGui")
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.IgnoreGuiInset = true
screenGui.DisplayOrder = 2

-- Frame principal
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 500, 0, 300)
mainFrame.Position = UDim2.new(0.5, -250, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
mainFrame.BackgroundTransparency = 0.4
mainFrame.BorderSizePixel = 0
mainFrame.Visible = true
mainFrame.Parent = screenGui

-- Gradiente
local uiGradient = Instance.new("UIGradient")
uiGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 20, 20)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 50, 50))
}
uiGradient.Rotation = 45
uiGradient.Parent = mainFrame

-- Esquinas redondeadas
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 16)
uiCorner.Parent = mainFrame

-- Borde blanco
local uiStroke = Instance.new("UIStroke")
uiStroke.Thickness = 2
uiStroke.Color = Color3.fromRGB(255, 255, 255)
uiStroke.Transparency = 0.6
uiStroke.Parent = mainFrame

-- T√≠tulo
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 60)
titleLabel.Position = UDim2.new(0, 0, 0, 10)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Emote Hub"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 28
titleLabel.Font = Enum.Font.GothamBold
titleLabel.Parent = mainFrame

-- Bot√≥n de cierre
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 40, 0, 40)
closeButton.Position = UDim2.new(1, -50, 0, 10)
closeButton.BackgroundTransparency = 1
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Text = "X"
closeButton.TextSize = 20
closeButton.Font = Enum.Font.Gotham
closeButton.Parent = mainFrame
uiCorner:Clone().Parent = closeButton

-- Barra de √∫ltimo emote
local lastEmoteButton = Instance.new("TextButton")
lastEmoteButton.Size = UDim2.new(0, 500, 0, 40)
lastEmoteButton.Position = UDim2.new(0.5, -250, 0.5, 160)
lastEmoteButton.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
lastEmoteButton.BackgroundTransparency = 0.4
lastEmoteButton.BorderSizePixel = 0
lastEmoteButton.Text = "No emote selected"
lastEmoteButton.TextColor3.fromRGB(255, 255, 255)
lastEmoteButton.TextSize = 18
lastEmoteButton.Font = Enum.Font.GothamBold
lastEmoteButton.TextWrapped = true
lastEmoteButton.TextTruncate = Enum.TextTruncate.AtEnd
lastEmoteButton.Visible = true
lastEmoteButton.Parent = screenGui
uiGradient:Clone().Parent = lastEmoteButton
uiCorner:Clone().Parent = lastEmoteButton
local lastEmoteStroke = uiStroke:Clone()
lastEmoteStroke.Color = Color3.fromRGB(255, 255, 255)
lastEmoteStroke.Thickness = 2
lastEmoteStroke.Parent = lastEmoteButton

-- Barra de b√∫squeda
local searchBar = Instance.new("TextBox")
searchBar.Size = UDim2.new(0, 500, 0, 40)
searchBar.Position = UDim2.new(0, -250, 0.5, 210)
searchBar.BackgroundTransparency = Color3.fromRGB(20, 20, 20)
searchBar.BackgroundTransparency = 0.4
searchBar.BackgroundTransparency = BorderSizePixel = 0
searchBar.Text = ""
searchBar.PlaceholderText = "Search emotes..."
searchBar.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
searchBar.TextColor3 = Color3.fromRGB(255, 255, 255)
searchBar.TextSize = 18
searchBar.Font = Enum.Font.GothamBold
searchBar.TextWrapped = true
searchBar.Visible = true
searchBar.Parent = screenGui
uiGradient:Clone().Parent = searchBar
uiCorner:Clone().Parent = searchBar
local searchStroke = uiStroke:Clone()
searchStroke.Color = Color3.fromRGB(255, 255, 255)
searchStroke.Thickness = 2
searchStroke.Parent = searchBar

-- √çcono de lupa
local magnifierIcon = Instance.new("TextLabel")
magnifierIcon.Size = UDim2.new(0, 40, 0, 40)
magnifierIcon.Position = UDim2.new(1, -40, 0, 0)
magnifierIcon.BackgroundTransparency = 1
magnifierIcon.Text = "üîç"
magnifierIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
magnifierIcon.TextSize = 20
magnifierIcon.Font = Enum.Font.GothamBold
magnifierIcon.Parent = searchBar

-- Variable para el √∫ltimo emote
local lastSelectedEmote = "No emote selected"
local tweenInfo = TweenInfo.new(0.7, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out)

-- Scroll de emotes
local emoteScroll = Instance.new("ScrollingFrame")
emoteScroll.Size = UDim2.new(0.9, 0, 0.6, 0)
emoteScroll.Position = UDim2.new(0.05, 0, 0.25, 0)
emoteScroll.BackgroundTransparency = 1
emoteScroll.BorderSizePixel = 0
emoteScroll.ScrollBarThickness = 5
emoteScroll.ScrollBarImageColor3 = Color3.fromRGB(255, 255, 255)
emoteScroll.ScrollBarImageTransparency = 0.5
emoteScroll.ScrollingDirection = Enum.ScrollingDirection.X
emoteScroll.Parent = mainFrame

-- UIGridLayout
local uiGridLayout = Instance.new("UIGridLayout")
uiGridLayout.CellSize = UDim2.new(0, 80, 0, 80)
uiGridLayout.CellPadding = UDim2.new(0, 10, 0, 10)
uiGridLayout.SortOrder = Enum.SortOrder.LayoutOrder
uiGridLayout.FillDirection = Enum.FillDirection.Horizontal
uiGridLayout.StartCorner = Enum.StartCorner.TopLeft
uiGridLayout.VerticalAlignment = Enum.VerticalAlignment.Top
uiGridLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
uiGridLayout.Parent = emoteScroll

-- Lista de emotes (165 emotes, TWICE verificados)
local emotes = {
    {Name = "TWICE ABCD by Nayeon", ID = 18933761755},
    {Name = "Country Line Dance Lil Nas X LNX", ID = 5915780563},
    {Name = "Air Guitar", ID = 3696761354},
    {Name = "BLACKPINK Ice Cream", ID = 16181840356},
    {Name = "BURBERRY LOLA ATTITUDE REFLEX", ID = 10147921916},
    {Name = "Udzal's Summoning", ID = 3307604888},
    {Name = "TWICE Like Ooh-Ahh", ID = 14124050904},
    {Name = "Superhero Reveal", ID = 3696759798},
    {Name = "Hype Dance", ID = 3696757129},
    {Name = "BLACKPINK JENNIE You and Me", ID = 15439457146},
    {Name = "TWICE The Feels", ID = 12874468267},
    {Name = "The Conductor George Ezra", ID = 10370926562},
    {Name = "BURBERRY LOLA ATTITUDE GEM", ID = 10147916560},
    {Name = "Annyeong", ID = 9528286240},
    {Name = "You can't sit with us Sunmi", ID = 9983549160},
    {Name = "BLACKPINK DDU-DU DDU-DU", ID = 16553262614},
    {Name = "Cha-Cha", ID = 3696764866},
    {Name = "Sandwich Dance", ID = 4390121879},
    {Name = "MANIAC Stray Kids", ID = 11309309359},
    {Name = "Man City Backflip", ID = 13694140956},
    {Name = "Nicki Minaj That's That Super Bass Emote", ID = 15571536896},
    {Name = "BLACKPINK Pink Venom Get em Get em Get em", ID = 14548709888},
    {Name = "BLACKPINK JISOO Flower", ID = 15439454888},
    {Name = "BURBERRY LOLA ATTITUDE NIMBUS", ID = 10147924028},
    {Name = "TWICE Set Me Free Dance 1", ID = 12715395038},
    {Name = "Olympic Dismount", ID = 18666650035},
    {Name = "TWICE What Is Love", ID = 13344121112},
    {Name = "NBA Monster Dunk", ID = 82163305721376},
    {Name = "BLACKPINK ROS√â On The Ground", ID = 15679958535},
    {Name = "BLACKPINK Shut Down Part 1", ID = 14901369589},
    {Name = "TWICE Strategy", ID = 106862678450011},
    {Name = "BURBERRY LOLA ATTITUDE BLOOM", ID = 10147919199},
    {Name = "Skadoosh Emote Kung Fu Panda 4", ID = 16371235025},
    {Name = "Swag Walk", ID = 10478377385},
    {Name = "SpongeBob Dance", ID = 18443271885},
    {Name = "TWICE Set Me Free Dance 2", ID = 12715397488},
    {Name = "BLACKPINK Pink Venom I Bring the Pain Like", ID = 14548710952},
    {Name = "Vans Ollie", ID = 18305539673},
    {Name = "TWICE Moonlight Sunrise", ID = 12715393154},
    {Name = "Vroom Vroom", ID = 18526410572},
    {Name = "Nicki Minaj Anaconda", ID = 15571539403},
    {Name = "Chicken Dance", ID = 4849493309},
    {Name = "BLACKPINK LISA Money", ID = 15679957363},
    {Name = "BLACKPINK Don't know what to do", ID = 18855609889},
    {Name = "TWICE Fancy", ID = 13520623514},
    {Name = "Borock's Rage", ID = 3236848555},
    {Name = "Gashina SUNMI", ID = 9528294735},
    {Name = "BLACKPINK How You Like That", ID = 16874596971},
    {Name = "Bunny Hop", ID = 4646296016},
    {Name = "BURBERRY LOLA ATTITUDE HYDRO", ID = 10147926081},
    {Name = "Fashion Spin", ID = 130046968468383},
    {Name = "BLACKPINK Kill This Love", ID = 16181843366},
    {Name = "Hyperfast 5G Dance Move", ID = 9408642191},
    {Name = "BLACKPINK Boombayah Emote", ID = 16553259683},
    {Name = "Man City Bicycle Kick", ID = 13422286833},
    {Name = "Heisman Pose", ID = 3696763549},
    {Name = "TWICE Pop by Nayeon", ID = 13768975574},
    {Name = "BLACKPINK Shut Down Part 2", ID = 14901371589},
    {Name = "BLACKPINK Pink Venom Straight to Ya Dome", ID = 14548711723},
    {Name = "Hwaiting", ID = 9528291779},
    {Name = "Victory 24kGoldn", ID = 9178397781},
    {Name = "Man City Scorpion Kick", ID = 13694139364},
    {Name = "BLACKPINK Lovesick Girls", ID = 16874600526},
    {Name = "BLACKPINK As If It's Your Last", ID = 18855603653},
    {Name = "Block Partier", ID = 6865011755},
    {Name = "Chill Vibes George Ezra", ID = 10370918044},
    {Name = "Drum Master Royal Blood", ID = 6531538868},
    {Name = "Drummer Moves Twenty One Pilots", ID = 7422838770},
    {Name = "Swish", ID = 3821527813},
    {Name = "Louder", ID = 3576751796},
    {Name = "Drum Solo Royal Blood", ID = 6532844183},
    {Name = "Rock Star Royal Blood", ID = 6533100850},
    {Name = "Air Dance", ID = 4646302011},
    {Name = "Up and Down Twenty One Pilots", ID = 7422843994},
    {Name = "Cobra Arms Tai Verdes", ID = 7942964447},
    {Name = "Sneaky", ID = 3576754235},
    {Name = "Air Guitar 2", ID = 15506499986},
    {Name = "Swan Dance", ID = 7466048475},
    {Name = "Idol", ID = 4102317848},
    {Name = "Elton John Cat Man", ID = 11435175895},
    {Name = "Rock Guitar Royal Blood", ID = 6532155086},
    {Name = "Jacks", ID = 3570649048},
    {Name = "Elton John Piano Jump", ID = 11453096488},
    {Name = "On The Outside Twenty One Pilots", ID = 7422841700},
    {Name = "Around Town", ID = 3576747102},
    {Name = "Boom Boom Clap George Ezra", ID = 10370934040},
    {Name = "Saturday Dance Twenty One Pilots", ID = 7422833723},
    {Name = "Top Rock", ID = 3570535774},
    {Name = "Keeping Time", ID = 4646306072},
    {Name = "Mean Mug Tommy Hilfiger", ID = 10214415687},
    {Name = "Fancy Feet", ID = 3934988903},
    {Name = "Rise Above The Chainsmokers", ID = 13071993910},
    {Name = "Sticker Dance Move NCT 127", ID = 12259885838},
    {Name = "NBA WNBA Fadeaway", ID = 18526373545},
    {Name = "Rodeo Dance Lil Nas X LNX", ID = 5938397555},
    {Name = "Panini Dance Lil Nas X LNX", ID = 5915781665},
    {Name = "Arm Twist", ID = 9710992846},
    {Name = "Shrek Roar", ID = 18524331128},
    {Name = "AOK Tai Verdes", ID = 7942960760},
    {Name = "Tantrum", ID = 5104374556},
    {Name = "2 Baddies Dance Move NCT 127", ID = 12259890638},
    {Name = "Lasso Turn Tai Verdes", ID = 7942972744},
    {Name = "Tommy K-Pop Mic Drop", ID = 14024722653},
    {Name = "Fishing", ID = 3994129128},
    {Name = "Cartwheel George Ezra", ID = 10370929905},
    {Name = "Robot", ID = 3576721660},
    {Name = "Fashion Klossette Runway my way", ID = 126683684984862},
    {Name = "Y", ID = 4391211308},
    {Name = "Hips Poppin Zara Larsson", ID = 6797919579},
    {Name = "Dorky Dance", ID = 4212499637},
    {Name = "HOLIDAY Dance Lil Nas X LNX", ID = 5938396308},
    {Name = "T", ID = 3576719440},
    {Name = "Shuffle", ID = 4391208058},
    {Name = "Take Me Under Zara Larsson", ID = 6797938823},
    {Name = "Tree", ID = 4049634387},
    {Name = "High Hands", ID = 9710994651},
    {Name = "Alo Yoga Pose Warrior II", ID = 12507106431},
    {Name = "Get Out", ID = 3934984583},
    {Name = "It Ain't My Fault Zara Larsson", ID = 6797948622},
    {Name = "Alo Yoga Pose Triangle", ID = 12507120275},
    {Name = "Jumping Cheer", ID = 5895009708},
    {Name = "Break Dance", ID = 5915773992},
    {Name = "Floor Rock Freeze Tommy Hilfiger", ID = 10214411646},
    {Name = "Super Charge", ID = 10478368365},
    {Name = "Kick It Dance Move NCT 127", ID = 12259888240},
    {Name = "Dave's Spin Move Glass Animals", ID = 16276501655},
    {Name = "SpongeBob Imaginaaation", ID = 18443268949},
    {Name = "TWICE I GOT YOU part 2", ID = 16256253954},
    {Name = "Cha-Cha 2", ID = 6865013133},
    {Name = "YUNGBLUD HIGH KICK", ID = 14022978026},
    {Name = "Flowing Breeze", ID = 7466047578},
    {Name = "Olivia Rodrigo good 4 u", ID = 15554013003},
    {Name = "Old Town Road Dance Lil Nas X LNX", ID = 5938394742},
    {Name = "The Zabb", ID = 71389516735424},
    {Name = "Disagree", ID = 4849495710},
    {Name = "Wanna play", ID = 16646438742},
    {Name = "Uprise Tommy Hilfiger", ID = 10275057230},
    {Name = "Elton John Still Standing", ID = 11435177473},
    {Name = "Wisp air guitar", ID = 17370797454},
    {Name = "TWICE I GOT YOU part 1", ID = 16215060261},
    {Name = "GloRilla Tomorrow Dance", ID = 15689315657},
    {Name = "Side to Side", ID = 3762641826},
    {Name = "Elton John Elevate", ID = 11394056822},
    {Name = "Twirl", ID = 3716633898},
    {Name = "Samba", ID = 6869813008},
    {Name = "Jawny Stomp", ID = 16392120020},
    {Name = "NBA Monster Dunk 2", ID = 117511481049460},
    {Name = "Paris Hilton Sanasa", ID = 16126526506},
    {Name = "Dancin Shoes Twenty One Pilots", ID = 7405123844},
    {Name = "Imagine Dragons Bones Dance", ID = 15689314578},
    {Name = "Baby Dance", ID = 4272484885},
    {Name = "TMNT Dance", ID = 18665886405},
    {Name = "Boxing Punch KSI", ID = 7202896732},
    {Name = "Mean Girls Dance Break", ID = 15963348695},
    {Name = "Celebrate", ID = 3994127840},
    {Name = "ericdoa dance", ID = 15698510244},
    {Name = "Line Dance", ID = 4049646104},
    {Name = "Sidekicks George Ezra", ID = 10370922566},
    {Name = "Agree", ID = 4849487550},
    {Name = "Confused", ID = 4940592718},
    {Name = "Mae Stephens Arm Wave", ID = 16584496781},
    {Name = "Rock On", ID = 5915782672},
    {Name = "Rock Out Bebe Rexha", ID = 18225077553},
    {Name = "Power Blast", ID = 4849497510},
    {Name = "Rock n Roll", ID = 15506496093},
    {Name = "Fashionable", ID = 3576745472},
    {Name = "Mini Kong", ID = 17000058939},
    {Name = "Ay-Yo Dance Move NCT 127", ID = 12804173616},
    {Name = "Paris Hilton Checking My Angles", ID = 15392937495},
    {Name = "Rolling Stones Guitar Strum", ID = 18148839527},
    {Name = "ALT:GO Couldn't Care Less", ID = 92859581691366},
    {Name = "DearALICE Ariana", ID = 133765015173412},
    {Name = "Elton John Rock Out", ID = 11753545334},
    {Name = "Dolphin Dance", ID = 5938365243},
    {Name = "Wake Up Call KSI", ID = 7202900159},
    {Name = "Bodybuilder", ID = 3994130516},
    {Name = "Fast Hands", ID = 4272351660},
    {Name = "Show Dem Wrists KSI", ID = 7202898984},
    {Name = "Jumping Wave", ID = 4940602656},
    {Name = "Olivia Rodrigo Fall Back to Float", ID = 15554016057},
    {Name = "High Wave", ID = 5915776835},
    {Name = "Paris Hilton Sliving For The Groove", ID = 15392927897},
    {Name = "Haha", ID = 4102315500},
    {Name = "Baby Queen Air Guitar Knee Slide", ID = 14353417553},
    {Name = "Happy", ID = 4849499887},
    {Name = "Cower", ID = 4940597758},
    {Name = "Fashion Roadkill", ID = 73683655527605},
    {Name = "Flex Walk", ID = 15506506103},
    {Name = "Zombie", ID = 4212496830},
    {Name = "Stray Kids Walkin On Water", ID = 100773414188482},
    {Name = "Dizzy", ID = 3934986896},
    {Name = "Team USA Breaking Emote", ID = 18526338976},
    {Name = "Beauty Touchdown", ID = 16303091119},
    {Name = "Tommy Archer", ID = 13823339506},
    {Name = "Nicki Minaj Boom Boom Boom", ID = 15571538346},
    {Name = "Sol de Janeiro Samba", ID = 16276506814},
    {Name = "Stadium", ID = 3360686498},
    {Name = "Point2", ID = 3576823880},
    {Name = "HUGO Let's Drive", ID = 17360720445},
    {Name = "Hello", ID = 3576686446},
    {Name = "Shrug", ID = 3576968026},
    {Name = "Nicki Minaj Starships", ID = 15571540519},
    {Name = "Elton John Heart Skip", ID = 11309263077},
    {Name = "Paris Hilton Iconic IT Grrrl", ID = 15392932768},
    {Name = "Sturdy Dance Ice Spice", ID = 17746270218},
    {Name = "Bone Chillin Bop", ID = 15123050663},
    {Name = "Skibidi Toilet Titan Speakerman Laser Spin", ID = 103102322875221},
    {Name = "Greatest", ID = 3762654854},
    {Name = "Quiet Waves", ID = 7466046574},
    {Name = "Chappell Roan HOT TO GO", ID = 79312439851071},
    {Name = "Frosty Flair Tommy Hilfiger", ID = 10214406616},
    {Name = "HIPMOTION Amaarae", ID = 16572756230},
    {Name = "Sad", ID = 4849502101},
    {Name = "TWICE LIKEY", ID = 14900151704},
    {Name = "Festive Dance", ID = 15679955281},
    {Name = "V-Pose Tommy Hilfiger", ID = 10214418283},
    {Name = "TWICE Feel Special", ID = 14900153406},
    {Name = "Floss Dance", ID = 5917570207},
    {Name = "Olivia Rodrigo Head Bop", ID = 15554010118},
    {Name = "Monkey", ID = 3716636630},
    {Name = "Curtsy", ID = 4646306583},
    {Name = "Hero Landing", ID = 5104377791},
    {Name = "Shy", ID = 3576717965},
    {Name = "Sleep", ID = 4689362868},
    {Name = "Elton John Heart Shuffle", ID = 17748346932},
    {Name = "Victory Dance", ID = 15506503658},
    {Name = "Bored", ID = 5230661597},
    {Name = "Cuco Levitate", ID = 15698511500},
    {Name = "d4vd Backflip", ID = 15694504637},
    {Name = "Alo Yoga Pose Lotus Position", ID = 12507097350},
    {Name = "Mae Stephens Piano Hands", ID = 16553249658},
    {Name = "The Weeknd Starboy Strut", ID = 130245358716273},
    {Name = "Baby Queen Strut", ID = 14353425085},
    {Name = "Secret Handshake Dance", ID = 120642514156293},
    {Name = "Godlike", ID = 3823158750},
    {Name = "KATSEYE Touch", ID = 139021427684680},
    {Name = "Baby Queen Bouncy Twirl", ID = 14353423348},
    {Name = "Baby Queen Face Frame", ID = 14353421343},
    {Name = "Yungblud Happier Jump", ID = 15610015346},
    {Name = "TWICE Cheer Up", ID = 14900148971},
    {Name = "TWICE TT", ID = 14900150330},
    {Name = "TWICE Dance The Night Away", ID = 14900152679},
    {Name = "TWICE YES or YES", ID = 14900154154},
    {Name = "TWICE Heart Shaker", ID = 14900155038},
    {Name = "TWICE I CAN'T STOP ME", ID = 14900156701},
    {Name = "TWICE CRY FOR ME", ID = 14900157583},
    {Name = "TWICE SCIENTIST", ID = 14900158375},
    {Name = "TWICE Talk that Talk", ID = 14900159308}
}

-- Esperar al personaje
local function waitForCharacter()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
        return true
    end
    LocalPlayer.CharacterAdded:Wait()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
        return true
    end
    return false
end

if not waitForCharacter() then
    sendNotification("Error", "No se pudo cargar el personaje.", 10)
    print("Error: No se pudo cargar el personaje")
    screenGui:Destroy()
    return
end

-- Funci√≥n para reproducir emote
local function playEmote(id, emoteName)
    local success, err = pcall(function()
        local character = LocalPlayer.Character
        if not (character and character:FindFirstChildOfClass("Humanoid")) then
            error("Personaje o Humanoid no encontrado")
        end
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid.RigType == Enum.HumanoidRigType.R6 then
            error("Requiere avatar R15")
        end
        humanoid:PlayEmoteAndGetAnimTrackById(id)
        sendNotification("√âxito", "Emote: " .. emoteName, 4)
        print("‚úÖ Emote: " .. emoteName .. " (ID: " .. id .. ")")
    end)

    if not success then
        sendNotification("Error", "No se pudo ejecutar " .. emoteName .. ": " .. tostring(err), 6)
        print("Error en " .. emoteName .. ": " .. tostring(err))
        local successFallback, errFallback = pcall(function()
            local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)
            local animation = Instance.new("Animation")
            animation.AnimationId = "rbxassetid://" .. id
            local animTrack = animator:LoadAnimation(animation)
            animTrack:Play()
            sendNotification("√âxito", "Emote (fallback): " .. emoteName, 4)
        end)
        if not successFallback then
            sendNotification("Error", "Fallback fall√≥: " .. emoteName, 6)
        end
    end
end

-- Crear botones de emotes
local emoteButtons = {}
for i, emote in ipairs(emotes) do
    local success, err = pcall(function()
        local emoteButton = Instance.new("ImageButton")
        emoteButton.Size = UDim2.new(0, 80, 0, 80)
        emoteButton.BackgroundTransparency = 1
        emoteButton.Image = "rbxthumb://type=Asset&id=" .. emote.ID .. "&w=420&h=420"
        emoteButton.Name = "EmoteButton_" .. emote.Name
        emoteButton.Parent = emoteScroll
        table.insert(emoteButtons, emoteButton)

        local buttonCorner = uiCorner:Clone()
        buttonCorner.CornerRadius = UDim.new(0, 8)
        buttonCorner.Parent = emoteButton

        local buttonStroke = uiStroke:Clone()
        buttonStroke.Thickness = 1
        buttonStroke.Color = Color3.fromRGB(255, 255, 255)
        buttonStroke.Transparency = 0.7
        buttonStroke.Parent = emoteButton

        emoteButton.MouseButton1Down:Connect(function()
            lastEmoteButton.Text = emote.Name
        end)

        emoteButton.MouseButton1Up:Connect(function()
            lastSelectedEmote = emote.Name
            lastEmoteButton.Text = lastSelectedEmote
            playEmote(emote.ID, emote.Name)
        end)
    end)
    if not success then
        sendNotification("Error", "No se pudo crear bot√≥n: " .. emote.Name, 6)
        print("Error creando bot√≥n: " .. tostring(err))
    end
end

-- Ajustar CanvasSize
local buttonsPerRow = math.ceil(#emotes / 2)
local extraSpace = 200
emoteScroll.CanvasSize = UDim2.new(0, (80 + 10) * buttonsPerRow + extraSpace, 0, (80 + 10) * 2)

-- Funcionalidad de b√∫squeda
searchBar.Changed:Connect(function(property)
    if property == "Text" then
        local searchText = searchBar.Text:lower()
        for _, button in pairs(emoteButtons) do
            local emoteName = button.Name:sub(12)
            button.Visible = searchText == "" or emoteName:lower():find(searchText)
        end
    end
end)

-- Icono XSL
local iconFrame = Instance.new("Frame")
iconFrame.Size = UDim2.new(0, 60, 0, 60)
iconFrame.Position = UDim2.new(0.55, 0, 0.9, 0)
iconFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
iconFrame.BackgroundTransparency = 0.4
iconFrame.BorderSizePixel = 0
iconFrame.Parent = screenGui
uiGradient:Clone().Parent = iconFrame
uiCorner:Clone().Parent = iconFrame
uiStroke:Clone().Parent = iconFrame

local iconLabel = Instance.new("TextLabel")
iconLabel.Size = UDim2.new(1, 0, 1, 0)
iconLabel.BackgroundTransparency = 1
iconLabel.Text = "XSL"
iconLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
iconLabel.TextSize = 20
iconLabel.Font = Enum.Font.GothamBold
iconLabel.Parent = iconFrame

-- Animaci√≥n de entrada
local function animateEntrance()
    mainFrame.Position = UDim2.new(0.5, -250, 0.5, -350)
    lastEmoteButton.Position = UDim2.new(0.5, -250, 0.5, -190)
    searchBar.Position = UDim2.new(0.5, -250, 0.5, -140)
    mainFrame.BackgroundTransparency = 1
    lastEmoteButton.BackgroundTransparency = 1
    searchBar.BackgroundTransparency = 1
    local tweenMain = TweenService:Create(mainFrame, tweenInfo, {
        Position = UDim2.new(0.5, -250, 0.5, -150),
        BackgroundTransparency = 0.4
    })
    local tweenLastEmote = TweenService:Create(lastEmoteButton, tweenInfo, {
        Position = UDim2.new(0.5, -250, 0.5, 160),
        BackgroundTransparency = 0.4
    })
    local tweenSearch = TweenService:Create(searchBar, tweenInfo, {
        Position = UDim2.new(0.5, -250, 0.5, 210),
        BackgroundTransparency = 0.4
    })
    tweenMain:Play()
    tweenLastEmote:Play()
    tweenSearch:Play()
end

-- Alternar visibilidad
local function toggleHub()
    if mainFrame.Visible then
        local tweenOutMain = TweenService:Create(mainFrame, tweenInfo, {Position = UDim2.new(0.5, -250, 0.5, -350)})
        local tweenOutLastEmote = TweenService:Create(lastEmoteButton, tweenInfo, {Position = UDim2.new(0.5, -250, 0.5, -190)})
        local tweenOutSearch = TweenService:Create(searchBar, tweenInfo, {Position = UDim2.new(0.5, -250, 0.5, -140)})
        tweenOutMain:Play()
        tweenOutLastEmote:Play()
        tweenOutSearch:Play()
        tweenOutMain.Completed:Connect(function()
            mainFrame.Visible = false
            lastEmoteButton.Visible = false
            searchBar.Visible = false
        end)
    else
        mainFrame.Visible = true
        lastEmoteButton.Visible = true
        searchBar.Visible = true
        animateEntrance()
    end
end

-- L√≥gica de arrastre
local isDragging = false
local dragStart = Vector2.new()
local initialPosition = UDim2.new()
local lastEmoteInitialPosition = UDim2.new()
local searchBarInitialPosition = UDim2.new()

local function onDragBegan(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isDragging = true
        dragStart = input.Position
        initialPosition = mainFrame.Position
        lastEmoteInitialPosition = lastEmoteButton.Position
        searchBarInitialPosition = searchBar.Position
    end
end

local function onDragMoved(input)
    if isDragging then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(
            initialPosition.X.Scale, initialPosition.X.Offset + delta.X,
            initialPosition.Y.Scale, initialPosition.Y.Offset + delta.Y
        )
        lastEmoteButton.Position = UDim2.new(
            lastEmoteInitialPosition.X.Scale, lastEmoteInitialPosition.X.Offset + delta.X,
            lastEmoteInitialPosition.Y.Scale, lastEmoteInitialPosition.Y.Offset + delta.Y
        )
        searchBar.Position = UDim2.new(
            searchBarInitialPosition.X.Scale, searchBarInitialPosition.X.Offset + delta.X,
            searchBarInitialPosition.Y.Scale, searchBarInitialPosition.Y.Offset + delta.Y
        )
    end
end

mainFrame.InputBegan:Connect(onDragBegan)
mainFrame.InputChanged:Connect(onDragMoved)

-- Arrastre del icono
local isIconDragging = false
local iconDragStart = Vector2.new()
local iconInitialPosition = UDim2.new()

local function onIconDragBegan(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isIconDragging = true
        iconDragStart = input.Position
        iconInitialPosition = iconFrame.Position
    end
end

local function onIconDragMoved(input)
    if isIconDragging then
        local delta = input.Position - iconDragStart
        iconFrame.Position = UDim2.new(
            iconInitialPosition.X.Scale, iconInitialPosition.X.Offset + delta.X,
            iconInitialPosition.Y.Scale, iconInitialPosition.Y.Offset + delta.Y
        )
    end
end

iconFrame.InputBegan:Connect(onIconDragBegan)
iconFrame.InputChanged:Connect(onIconDragMoved)

-- Clic en icono
iconFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        if not isIconDragging then
            toggleHub()
        end
        isIconDragging = false
    end
end)

-- Tecla H
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.H then
        toggleHub()
    end
end)

-- Limpieza
local function cleanup()
    print("Limpiando GUI...")
    ContextActionService:UnbindCoreAction("Emote Menu Toggle")
    screenGui:Destroy()
    print("GUI limpiada")
end

closeButton.MouseButton1Click:Connect(function()
    local tweenOutMain = TweenService:Create(mainFrame, tweenInfo, {Position = UDim2.new(0.5, -250, 0.5, -350)})
    local tweenOutLastEmote = TweenService:Create(lastEmoteButton, tweenInfo, {Position = UDim2.new(0.5, -250, 0.5, -190)})
    local tweenOutSearch = TweenService:Create(searchBar, tweenInfo, {Position = UDim2.new(0.5, -250, 0.5, -140)})
    tweenOutMain:Play()
    tweenOutLastEmote:Play()
    tweenOutSearch:Play()
    tweenOutMain.Completed:Connect(cleanup)
end)

-- Animaci√≥n inicial
animateEntrance()
sendNotification("Listo", "Emote GUI cargada", 10)
print("Emote Hub cargado")
